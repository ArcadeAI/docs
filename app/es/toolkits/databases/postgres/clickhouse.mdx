# Clickhouse

import ToolInfo from "@/app/_components/tool-info";
import Badges from "@/app/_components/badges";
import TabbedCodeBlock from "@/app/_components/tabbed-code-block";
import TableOfContents from "@/app/_components/table-of-contents";
import ToolFooter from "@/app/_components/tool-footer";
import { Callout } from "nextra/components";

<ToolInfo
  description="Permitir a los agentes interactuar con bases de datos Clickhouse (solo lectura)."
  author="Arcade"
  codeLink="https://github.com/ArcadeAI/arcade-ai/tree/main/toolkits/clickhouse"
  authType="cadena de conexión de base de datos"
  versions={["0.1.0"]}
/>

<Badges repo="arcadeai/arcade-clickhouse" />

El kit de herramientas Clickhouse de Arcade proporciona un conjunto predefinido de herramientas para interactuar con bases de datos Clickhouse de manera de solo lectura. Este kit permite a los agentes descubrir esquemas de bases de datos, explorar estructuras de tablas y ejecutar consultas SELECT de manera segura. Este kit es un complemento de la publicación del blog [Diseñando herramientas SQL para agentes de IA](https://blog.arcade.dev/sql-tools-ai-agents-security).

<Callout type="info">
Este kit de herramientas está destinado a ser un ejemplo de cómo construir un kit de herramientas para una base de datos y no está destinado a ser utilizado en producción; no lo encontrarás listado en el panel de Arcade o en las API. Para uso en producción, recomendamos bifurcar este repositorio y construir tu propio kit de herramientas con herramientas específicas para tu caso de uso.
</Callout>

## Características Clave

Este kit de herramientas demuestra varios conceptos importantes para interacciones con bases de datos impulsadas por LLM:

* **Descubrimiento de Esquemas**: Descubrir automáticamente los esquemas de bases de datos disponibles
* **Exploración de Tablas**: Encontrar todas las tablas dentro de un esquema específico
* **Inspección de Esquemas**: Obtener información detallada de las columnas, incluidos tipos de datos, claves primarias e índices
* **Ejecución Segura de Consultas**: Ejecutar consultas SELECT con medidas de seguridad integradas
* **Agrupamiento de Conexiones**: Reutilizar conexiones de base de datos de manera eficiente
* **Acceso Solo Lectura**: Hacer cumplir el acceso solo lectura para prevenir la modificación de datos
* **Límites de Filas**: Limitar automáticamente los resultados de las consultas para evitar respuestas abrumadoras

## Herramientas Disponibles

<TableOfContents
  headers={["Nombre de la Herramienta", "Descripción"]}
  data={
    [
      ['Clickhouse.DiscoverDatabases', "Descubrir todas las bases de datos en una base de datos Clickhouse."],
      ['Clickhouse.DiscoverSchemas', "Descubrir todos los esquemas en una base de datos Clickhouse."],
      ['Clickhouse.DiscoverTables', "Descubrir todas las tablas en un esquema específico."],
      ['Clickhouse.GetTableSchema', "Obtener el esquema detallado de una tabla específica."],
      ['Clickhouse.ExecuteSelectQuery', "Ejecutar una consulta SELECT con soporte integral de cláusulas."],
    ]
  }
/>

Ten en cuenta que todas las herramientas requieren que se establezca el secreto `CLICKHOUSE_DATABASE_CONNECTION_STRING`.

## Clickhouse.DiscoverDatabases

Descubrir todas las bases de datos en una base de datos Clickhouse. Esta herramienta devuelve una lista de todas las bases de datos disponibles.

<TabbedCodeBlock
  tabs={[
    {
      label: "Llamar a la Herramienta",
      content: {
        Python: [
          "/examples/integrations/toolkits/clickhouse/discover_databases_example_call_tool.py",
        ],
        JavaScript: ["/examples/integrations/toolkits/clickhouse/discover_databases_example_call_tool.js"],
      },
    }
  ]}
/>

## Clickhouse.DiscoverSchemas

Descubrir todos los esquemas en una base de datos Clickhouse. Esta herramienta devuelve una lista de todos los esquemas disponibles, excluyendo el `information_schema` por razones de seguridad.

<TabbedCodeBlock
  tabs={[
    {
      label: "Llamar a la Herramienta",
      content: {
        Python: [
          "/examples/integrations/toolkits/clickhouse/discover_schemas_example_call_tool.py",
        ],
        JavaScript: ["/examples/integrations/toolkits/clickhouse/discover_schemas_example_call_tool.js"],
      },
    }
  ]}
/>

## Clickhouse.DiscoverTables

Descubrir todas las tablas en un esquema específico. Esta herramienta debe ser utilizada antes de cualquier otra herramienta que requiera un nombre de tabla.

**Parámetros:**
- `schema_name` (str): El esquema de base de datos en el que descubrir tablas (por defecto: "public")

<TabbedCodeBlock
  tabs={[
    {
      label: "Llamar a la Herramienta",
      content: {
        Python: [
          "/examples/integrations/toolkits/clickhouse/discover_tables_example_call_tool.py",
        ],
        JavaScript: ["/examples/integrations/toolkits/clickhouse/discover_tables_example_call_tool.js"],
      },
    }
  ]}
/>

## Clickhouse.GetTableSchema

Obtener el esquema detallado de una tabla específica. Esta herramienta proporciona información sobre las columnas, incluidos tipos de datos, indicadores de clave primaria e información de índices. Siempre usa esta herramienta antes de ejecutar cualquier consulta.

**Parámetros:**
- `schema_name` (str): El esquema de base de datos que contiene la tabla
- `table_name` (str): El nombre de la tabla a inspeccionar

<TabbedCodeBlock
  tabs={[
    {
      label: "Llamar a la Herramienta",
      content: {
        Python: [
          "/examples/integrations/toolkits/clickhouse/get_table_schema_example_call_tool.py",
        ],
        JavaScript: ["/examples/integrations/toolkits/clickhouse/get_table_schema_example_call_tool.js"],
      },
    }
  ]}
/>

## Clickhouse.ExecuteSelectQuery

Ejecutar una consulta SELECT con soporte integral de cláusulas. Esta herramienta te permite construir consultas complejas utilizando cláusulas individuales mientras mantienes la seguridad y el rendimiento.

**Parámetros:**
- `select_clause` (str): Columnas a seleccionar (sin la palabra clave SELECT)
- `from_clause` (str): Tabla(s) de las que consultar (sin la palabra clave FROM)
- `limit` (int): Máximo de filas a devolver (por defecto: 100)
- `offset` (int): Número de filas a omitir (por defecto: 0)
- `join_clause` (str, opcional): Condiciones JOIN (sin la palabra clave JOIN)
- `where_clause` (str, opcional): Condiciones WHERE (sin la palabra clave WHERE)
- `having_clause` (str, opcional): Condiciones HAVING (sin la palabra clave HAVING)
- `group_by_clause` (str, opcional): Columnas GROUP BY (sin la palabra clave GROUP BY)
- `order_by_clause` (str, opcional): Columnas ORDER BY (sin la palabra clave ORDER BY)
- `with_clause` (str, opcional): Cláusula WITH para CTEs (sin la palabra clave WITH)

**Construcción de Consultas:**
La consulta final se construye como:
```sql
SELECT {select_clause} FROM {from_clause}
JOIN {join_clause}
WHERE {where_clause}
HAVING {having_clause}
GROUP BY {group_by_clause}
ORDER BY {order_by_clause}
LIMIT {limit} OFFSET {offset}
```

**Mejores Prácticas:**
- Siempre usa `discover_tables` y `get_table_schema` antes de ejecutar consultas
- Nunca uses "SELECT *" - siempre especifica las columnas que necesitas
- Ordena los resultados por claves primarias o columnas importantes
- Usa coincidencias de cadenas sin distinción entre mayúsculas y minúsculas
- Recorta cadenas en las consultas
- Prefiere consultas LIKE sobre coincidencias exactas o regex
- Solo une en columnas indexadas o claves primarias

<TabbedCodeBlock
  tabs={[
    {
      label: "Llamar a la Herramienta",
      content: {
        Python: [
          "/examples/integrations/toolkits/clickhouse/execute_select_query_example_call_tool.py",
        ],
        JavaScript: ["/examples/integrations/toolkits/clickhouse/execute_select_query_example_call_tool.js"],
      },
    }
  ]}
/>

## Flujo de Trabajo de Uso

Para obtener resultados óptimos, sigue este flujo de trabajo al usar el kit de herramientas Clickhouse:

1. **Descubrir Esquemas**: Usa `discover_schemas` para ver los esquemas disponibles
2. **Descubrir Tablas**: Usa `discover_tables` con tu esquema objetivo
3. **Obtener Esquema de Tabla**: Usa `get_table_schema` para cada tabla que planeas consultar
4. **Ejecutar Consulta**: Usa `execute_select_query` con la información del esquema

Este flujo de trabajo asegura que tu agente tenga información completa sobre la estructura de la base de datos antes de intentar consultas, reduciendo errores y mejorando el rendimiento de las consultas.

<ToolFooter pipPackageName="arcade_clickhouse"/>