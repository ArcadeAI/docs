# Postgres

import ToolInfo from "@/app/_components/tool-info";
import Badges from "@/app/_components/badges";
import TabbedCodeBlock from "@/app/_components/tabbed-code-block";
import TableOfContents from "@/app/_components/table-of-contents";
import ToolFooter from "@/app/_components/tool-footer";
import { Callout } from "nextra/components";

<ToolInfo
  description="Permitir a los agentes interactuar con bases de datos PostgreSQL (solo lectura)."
  author="Arcade"
  codeLink="https://github.com/ArcadeAI/arcade-ai/tree/main/toolkits/postgres"
  authType="cadena de conexión de base de datos"
  versions={["0.1.0"]}
/>

<Badges repo="arcadeai/arcade-postgres" />

El kit de herramientas de Arcade Postgres proporciona un conjunto predefinido de herramientas para interactuar con bases de datos PostgreSQL de manera de solo lectura. Este kit permite a los agentes descubrir esquemas de base de datos, explorar estructuras de tablas y ejecutar consultas SELECT de forma segura. Este kit es un complemento de la publicación del blog [Diseñando herramientas SQL para agentes de IA](https://blog.arcade.dev/sql-tools-ai-agents-security).

<Callout type="info">
Este kit de herramientas está destinado a ser un ejemplo de cómo construir un kit de herramientas para una base de datos, y no está destinado a ser utilizado en producción; no lo encontrarás listado en el panel de Arcade o en las API. Para uso en producción, recomendamos bifurcar este repositorio y construir tu propio kit de herramientas con herramientas específicas para el caso de uso.
</Callout>

## Características Clave

Este kit de herramientas demuestra varios conceptos importantes para interacciones con bases de datos impulsadas por LLM:

- **Descubrimiento de Esquemas**: Descubrir automáticamente los esquemas de base de datos disponibles
- **Exploración de Tablas**: Encontrar todas las tablas dentro de un esquema específico
- **Inspección de Esquemas**: Obtener información detallada sobre las columnas, incluidos tipos de datos, claves primarias e índices
- **Ejecución Segura de Consultas**: Ejecutar consultas SELECT con medidas de seguridad integradas
- **Agrupamiento de Conexiones**: Reutilizar conexiones de base de datos de manera eficiente
- **Acceso Solo Lectura**: Hacer cumplir el acceso solo lectura para prevenir la modificación de datos
- **Límites de Filas**: Limitar automáticamente los resultados de las consultas para evitar respuestas abrumadoras

## Herramientas Disponibles

<TableOfContents
  headers={["Nombre de la Herramienta", "Descripción"]}
  data={[
    [
      "Postgres.DiscoverSchemas",
      "Descubrir todos los esquemas en una base de datos PostgreSQL.",
    ],
    ["Postgres.DiscoverTables", "Descubrir todas las tablas en un esquema específico."],
    ["Postgres.GetTableSchema", "Obtener el esquema detallado de una tabla específica."],
    [
      "Postgres.ExecuteSelectQuery",
      "Ejecutar una consulta SELECT con soporte integral de cláusulas.",
    ],
  ]}
/>

Ten en cuenta que todas las herramientas requieren que se establezca el secreto `POSTGRES_DATABASE_CONNECTION_STRING`.

## Postgres.DiscoverSchemas

Descubrir todos los esquemas en una base de datos PostgreSQL. Esta herramienta devuelve una lista de todos los esquemas disponibles, excluyendo el `information_schema` por razones de seguridad.

<TabbedCodeBlock
  tabs={[
    {
      label: "Llamar a la Herramienta",
      content: {
        Python: [
          "/examples/integrations/toolkits/postgres/discover_schemas_example_call_tool.py",
        ],
        JavaScript: [
          "/examples/integrations/toolkits/postgres/discover_schemas_example_call_tool.js",
        ],
      },
    },
  ]}
/>

## Postgres.DiscoverTables

Descubrir todas las tablas en un esquema específico. Esta herramienta debe ser utilizada antes de cualquier otra herramienta que requiera un nombre de tabla.

**Parámetros:**

- `schema_name` (str): El esquema de base de datos para descubrir tablas (predeterminado: "public")

<TabbedCodeBlock
  tabs={[
    {
      label: "Llamar a la Herramienta",
      content: {
        Python: [
          "/examples/integrations/toolkits/postgres/discover_tables_example_call_tool.py",
        ],
        JavaScript: [
          "/examples/integrations/toolkits/postgres/discover_tables_example_call_tool.js",
        ],
      },
    },
  ]}
/>

## Postgres.GetTableSchema

Obtener el esquema detallado de una tabla específica. Esta herramienta proporciona información sobre las columnas, incluidos los tipos de datos, indicadores de clave primaria e información de índice. Siempre utiliza esta herramienta antes de ejecutar cualquier consulta.

**Parámetros:**

- `schema_name` (str): El esquema de base de datos que contiene la tabla
- `table_name` (str): El nombre de la tabla a inspeccionar

<TabbedCodeBlock
  tabs={[
    {
      label: "Llamar a la Herramienta",
      content: {
        Python: [
          "/examples/integrations/toolkits/postgres/get_table_schema_example_call_tool.py",
        ],
        JavaScript: [
          "/examples/integrations/toolkits/postgres/get_table_schema_example_call_tool.js",
        ],
      },
    },
  ]}
/>

## Postgres.ExecuteSelectQuery

Ejecutar una consulta SELECT con soporte integral de cláusulas. Esta herramienta te permite construir consultas complejas utilizando cláusulas individuales mientras mantiene la seguridad y el rendimiento.

**Parámetros:**

- `select_clause` (str): Columnas a seleccionar (sin la palabra clave SELECT)
- `from_clause` (str): Tabla(s) de las que consultar (sin la palabra clave FROM)
- `limit` (int): Máximo de filas a devolver (predeterminado: 100)
- `offset` (int): Número de filas a omitir (predeterminado: 0)
- `join_clause` (str, opcional): Condiciones JOIN (sin la palabra clave JOIN)
- `where_clause` (str, opcional): Condiciones WHERE (sin la palabra clave WHERE)
- `having_clause` (str, opcional): Condiciones HAVING (sin la palabra clave HAVING)
- `group_by_clause` (str, opcional): Columnas GROUP BY (sin la palabra clave GROUP BY)
- `order_by_clause` (str, opcional): Columnas ORDER BY (sin la palabra clave ORDER BY)
- `with_clause` (str, opcional): Cláusula WITH para CTEs (sin la palabra clave WITH)

**Construcción de Consultas:**
La consulta final se construye como:

```sql
SELECT {select_clause} FROM {from_clause}
JOIN {join_clause}
WHERE {where_clause}
HAVING {having_clause}
GROUP BY {group_by_clause}
ORDER BY {order_by_clause}
LIMIT {limit} OFFSET {offset}
```

**Mejores Prácticas:**

- Siempre utiliza `discover_tables` y `get_table_schema` antes de ejecutar consultas
- Nunca uses "SELECT \*" - siempre especifica las columnas que necesitas
- Ordena los resultados por claves primarias o columnas importantes
- Utiliza coincidencias de cadenas sin distinción entre mayúsculas y minúsculas
- Recorta cadenas en las consultas
- Prefiere consultas LIKE sobre coincidencias exactas o regex
- Únicamente une en columnas indexadas o claves primarias

<TabbedCodeBlock
  tabs={[
    {
      label: "Llamar a la Herramienta",
      content: {
        Python: [
          "/examples/integrations/toolkits/postgres/execute_select_query_example_call_tool.py",
        ],
        JavaScript: [
          "/examples/integrations/toolkits/postgres/execute_select_query_example_call_tool.js",
        ],
      },
    },
  ]}
/>

## Flujo de Trabajo de Uso

Para obtener resultados óptimos, sigue este flujo de trabajo al utilizar el kit de herramientas de Postgres:

1. **Descubrir Esquemas**: Utiliza `discover_schemas` para ver los esquemas disponibles
2. **Descubrir Tablas**: Utiliza `discover_tables` con tu esquema objetivo
3. **Obtener Esquema de Tabla**: Utiliza `get_table_schema` para cada tabla que planeas consultar
4. **Ejecutar Consulta**: Utiliza `execute_select_query` con la información del esquema

Este flujo de trabajo asegura que tu agente tenga información completa sobre la estructura de la base de datos antes de intentar consultas, reduciendo errores y mejorando el rendimiento de las consultas.

<ToolFooter pipPackageName="arcade_postgres"/>