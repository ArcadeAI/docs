---
title: "Add user authorization to your MCP tools"
description: "Learn how to build custom MCP tools that require user authorization using Arcade, auth providers, and OAuth."
---

import { Steps, Tabs, Callout } from "nextra/components";

# Add user authorization to your MCP tools

<GuideOverview>
<GuideOverview.Outcomes>

Create and use an MCP tool that requires OAuth to access Reddit, prompting users to authorize the action when called.

</GuideOverview.Outcomes>

<GuideOverview.Prerequisites>

- [Arcade account](https://api.arcade.dev/signup)
- [uv package manager](https://docs.astral.sh/uv/getting-started/installation/)
- [Arcade CLI](/home/quickstart)

</GuideOverview.Prerequisites>

<GuideOverview.YouWillLearn>

- How auth providers work.
- How to add user authorization to your custom tools with Arcade.
- How to use the Context to make authenticated requests to external APIs.
- How to use the Reddit auth provider to authorize your tool.

</GuideOverview.YouWillLearn>
</GuideOverview>

An auth provider is the service that issues and manages the OAuth token your tool uses. It is the identity “source of truth” your tool integrates with to request permissions and obtain OAuth tokens.

When you create a tool with `requires_auth`, you specify which provider to use. In this example, **`arcade_mcp_server.auth.Reddit` specifies the Reddit auth provider.**

## How auth providers work during execution

1. The user authenticates once with Arcade.
2. When the tool runs, Arcade performs the provider-specific OAuth flow for the requested scopes.
3. The provider issues a token, and Arcade securely injects it into the tool’s Context.
4. Your tool uses that token to call the provider’s API (e.g., `https://oauth.reddit.com`), without the LLM or client ever seeing the token.

The auth provider defines where the identity lives, what permissions are available (scopes), and how tokens are issued and refreshed. In code, it’s the class you pass to `requires_auth` (e.g., `Reddit(scopes=“read”])`) that encodes the OAuth details for that service.

## Add user authorization to your MCP tools

<Steps>

### Import the necessary modules

Create a new Python file, e.g., `auth_tools.py`, and import the necessary modules:

```python showLineNumbers filename="auth_tools.py"
import sys
from typing import Annotated

import httpx
from arcade_mcp_server import Context, MCPApp
from arcade_mcp_server.auth import Reddit
```

### Create the MCP Server

Create an instance of the `MCPApp` class:

```python filename="auth_tools.py"
app = MCPApp(name="auth_example", version="1.0.0", log_level="DEBUG")
```

### Define your MCP tool

Now, define your tool using the `@app.tool` decorator and specify the required authorization, in this case, by using [Arcade's Reddit auth provider](/home/auth-providers/reddit).

Specifying the `requires_auth` parameter in the `@app.tool` decorator indicates that the tool needs user authorization. In this example, we're using the `Reddit` auth provider with the `read` scope:

```python showLineNumbers filename="auth_tools.py" {1-5}
@app.tool(
  requires_auth=Reddit(
    scopes=["read"]
   )
)
async def get_posts_in_subreddit(
    context: Context, subreddit: Annotated[str, "The name of the subreddit"]
) -> dict:
    """Get posts from a specific subreddit"""
    # Normalize the subreddit name
    subreddit = subreddit.lower().replace("r/", "").replace(" ", "")

    # Prepare the httpx request
    # OAuth token is injected into the context at runtime.
    # LLMs and MCP clients cannot see or access your OAuth tokens.
    oauth_token = context.get_auth_token_or_empty()
    headers = {
        "Authorization": f"Bearer {oauth_token}",
        "User-Agent": "mcp_server-mcp-server",
    }
    params = {"limit": 5}
    url = f"https://oauth.reddit.com/r/{subreddit}/hot"

    # Make the request
    async with httpx.AsyncClient() as client:
        response = await client.get(url, headers=headers, params=params)
        response.raise_for_status()

        # Return the response
        return response.json()
```

<Callout type="warning">

To use this tool, you need to install the Arcade CLI and run 'arcade login' to authenticate:

```bash
uv pip install arcade-mcp
arcade login
```

</Callout>

Arcade offers a number of [built-in auth providers](/home/auth-providers), including Slack, Google, and GitHub. You can also require authorization with a custom auth provider, using the `OAuth2` class, a subclass of the `ToolAuthorization` class:

```python
@app.tool(
  requires_auth=OAuth2(
    id="your-oauth-provider-id",
    scopes=["scope1", "scope2"],
  )
)
```

<Callout type="warning">
  The `OAuth2` class requires an `id` parameter to identify the auth provider in
  the Arcade Engine. For built-in providers like `Slack`, you can skip the `id`.
  The Arcade Engine will find the right provider using your credentials. While
  you can specify an `id` for built-in providers, only do this for private tools
  that won't be shared.
</Callout>

### Use your authorized tool with Arcade

Now you can use your custom authorized tool with Arcade in your application.

Here's an example of how to use your tool:

```python
from arcadepy import Arcade

client = Arcade()  # Automatically finds the `ARCADE_API_KEY` env variable

user_id = "{arcade_user_id}"

# Use the tool
response = client.tools.execute(
    tool_name="Slack.SendDmToUser",
    input={
        "user_name": "johndoe",
        "message": "Hello!",
    },
    user_id=user_id,
)

print(response.output.value)
```

### Handle authorization

Since your tool requires authorization, the first time you use it, the user (identified by `user_id`) needs to authorize access.

Arcade handles the authorization flow, prompting the user to visit a URL to grant permissions.

Your application should guide the user through this process.

</Steps>

### How it works

Arcade manages the OAuth flow, and provides the token in `context.authorization.token` when the tool is executed. Arcade also remembers the user's authorization tokens, so they won't have to go through the authorization process again until the auth expires or is revoked.

### Next steps

Try adding more authorized tools, or explore how to handle different authorization providers and scopes.
