---
title: "LangGraph"
description: "Learn how to integrate Arcade AI with LangGraph for advanced AI workflows"
---

import { Steps } from "nextra/components";

# Use Arcade with LangGraph

In this guide, you'll learn how to integrate Arcade AI with LangGraph to build advanced AI workflows, with and without tool execution.

<Steps>

### Prerequisites

- [Set up Arcade AI](/home/quickstart)
- Install the required packages:

```bash
pip install arcade-ai langchain-openai langgraph langchain-google-community
```

### Using Arcade for Authorization with LangGraph

#### Step 1: Initialize the Arcade client

```python
from arcadepy import Arcade

client = Arcade()  # Automatically finds the `ARCADE_API_KEY` env variable
```

#### Step 2: Initiate authorization

Use the Arcade client to authorize:

```python
import time
user_id = "user@example.com"

auth_response = client.tools.authorize(
    tool_name="ListEmails",
    user_id=user_id,
)

if auth_response.status != "completed":
    print("Please complete the authorization challenge:")
    print(auth_response.auth_url)

# Wait for the authorization to complete
auth_response = client.auth.wait_for_completion(auth_response)
```

#### Step 3: Obtain credentials

Get the gmail credentials with the token obtained from Arcade AI.

```python
from google.oauth2.credentials import Credentials
from langchain_google_community.gmail.utils import build_resource_service

creds = Credentials(auth_response.context.token)
api_service = build_resource_service(credentials=creds)
```

#### Step 4: Use the credentials in LangGraph

Now you can use the authorized API service in your LangGraph workflow.

```python
from langchain_openai import ChatOpenAI
from langgraph.prebuilt import create_react_agent
from langchain_google_community import GmailToolkit

toolkit = GmailToolkit(api_resource=api_service)
tools = toolkit.get_tools()

llm = ChatOpenAI(model="gpt-4o")
agent_executor = create_react_agent(llm, tools)

# Run the agent
example_query = "Read my latest emails and summarize them."

events = agent_executor.stream(
    {"messages": [("user", example_query)]},
    stream_mode="values",
)
for event in events:
    event["messages"][-1].pretty_print()
```

</Steps>

### Using Arcade tools in LangGraph

<Steps>

#### Step 1: Define the workflow

Use LangGraph to define a state graph workflow.

```python
from typing import TypedDict
from langgraph.graph import END, START, StateGraph
from langgraph.errors import NodeInterrupt
from arcadepy import Arcade

client = Arcade()  # Automatically finds the `ARCADE_API_KEY` env variable

class State(TypedDict):
    emails: Any

def step_1(state: State, config) -> State:
    # Authorization
    user_id = config["user_id"]
    auth_response = client.tools.authorize(
        tool_name="Google.ListEmails",
        user_id=user_id,
    )
    if auth_response.status != "completed":
        print("Please complete authorization:")
        print(auth_response.auth_url)
        raise NodeInterrupt("Awaiting user authorization")

    # Tool execution
    result = client.tools.execute(
        tool_name="Google.ListEmails",
        user_id=user_id,
        inputs={"n_emails": 5},
    )
    return {"emails": result}

# Build the state graph
builder = StateGraph(State)
builder.add_node("step_1", step_1)
builder.add_edge(START, "step_1")
builder.add_edge("step_1", END)
```

#### Step 2: Run the workflow

```python
graph = builder.compile()

config = {"user_id": "user@example.com"}
state = {"emails": None}

try:
    result = graph.invoke(state, config=config)
except NodeInterrupt as e:
    print(str(e))
    # Wait for user to complete authorization, then retry
    input("Press Enter after completing authorization...")
    result = graph.invoke(state, config=config)

print("Emails:", result["emails"])
```

</Steps>

### How it works

By integrating Arcade AI with LangGraph, you can build complex AI workflows that involve authorization and tool execution within a structured framework.

LangGraph manages the state and flow, while Arcade AI handles the tools and authorization.
